<div class="body-wrapper">
  <div class="csv-upload-btn-wrapper">
    <%= form_tag(upload_csv_object_statuses_path, multipart: true) do %>
      <div><%= file_field_tag 'file' %><%= submit_tag 'Upload CSV', id: 'upload-submit' %></div>
    <% end %>

    <div class="update-status">
    </div>
  </div>
</div>

<script>
    var $update_status = $('.update-status');

    $('#upload-submit').click(function (e) {
        e.preventDefault();
        $(this).prop('disabled', true);

        $update_status.text('Uploading the file ...');
        $('.csv-upload-btn-wrapper form').submit();

        receiveBroadCast();
    });

    function receiveBroadCast(){
        App.cable.subscriptions.create(
            {
                channel: 'CsvImportStatusChannel'
            },
            {
                received: function(data) {
                    $update_status.text(data.message);
                }
            }
        );
    }
</script>

<%= stylesheet_link_tag 'object_statuses/index' %>
